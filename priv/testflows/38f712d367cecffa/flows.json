[{"id":"38f712d367cecffa","type":"tab","label":"[genserver] triggering functionality","disabled":false,"info":"## Triggering functions on the module\n\nThis flow demonstrates how to call functions on the module using the inject node.\n\nAlso this module uses module name addressing meaning that the module <a class=\"ahl-node-only\" data-ids=\"4a8b029644bfca0f\">sample_counter_test01</a> is only started once, i.e., singleton instance.\n\nA series of increments are performed on the module but a single value of thirteen is generated because there is only a single process for the module.\n\n## Reset \n\nInitially the module is <a class=\"ahl-node-only\" data-ids=\"f8d81fa3377c22b9\">resetted</a> because it continues to exist even after the test, the module isn't replaced for each test rather it contains an existence within the BEAM. Therefore the counter is reset to one at the beginning of the test.\n\n","env":[]},{"id":"e09eca284daec5b5","type":"junction","z":"38f712d367cecffa","x":3152,"y":457.75,"wires":[["393212952d795da0","59481bbe768093b7"]]},{"id":"4a8b029644bfca0f","type":"erlmodule","z":"38f712d367cecffa","name":"","module_name":"sample_counter_test01","code":"-module(sample_counter_test01).\n\n%%\n%% APIs: https://www.erlang.org/doc/apps/stdlib/gen_server.html\n%%\n\n-behaviour(gen_server).\n\n-export([\n    start_link/0,\n    init/1,\n    handle_call/3,\n    handle_cast/2,\n    handle_info/2,\n    code_change/3,\n    terminate/2,\n    stop/0,\n    fail/0\n]).\n\n%%\n%% Externer exports\n-export([\n   increment/0,\n   decrement/0,\n   get_counter/0,\n   set_counter/1,\n   reset/0\n]).\n\n%%\n%% External APIs\nincrement() ->\n   gen_server:call(?MODULE, increment).\n\nreset() ->\n   gen_server:call(?MODULE, reset).\n\ndecrement() ->\n   gen_server:call(?MODULE, decrement).\n\nget_counter() ->\n   gen_server:call(?MODULE, get_counter).\n\nset_counter(Value) ->\n   gen_server:call(?MODULE, {set_counter, Value}).\n\n%%\n%%\nstart_link() ->\n    gen_server:start_link({local, ?MODULE}, ?MODULE, #{counter => 0}, []).\n\ninit(Args) ->\n    {ok, Args#{ counter => 1 }}.\n\nstop() ->\n    io:format(\"Terminging ~n\",[]),\n    gen_server:cast(?MODULE, stop).\n\nfail() ->\n    io:format(\"Failing ~n\",[]),\n    gen_server:cast(?MODULE, fail).\n\n\nterminate(_Event, _State) ->\n    ok.\n\ncode_change(_OldVersion, State, _Extra) ->\n    {ok, State}.\n\n%%\n%%\nhandle_call(increment, _From, #{ counter := Counter } = State) ->\n    {reply, ok, State#{ counter => Counter + 1}};\n\nhandle_call(reset, _From, State) ->\n    {reply, ok, State#{ counter => 1}};\n\nhandle_call(decrement, _From, #{ counter := Counter } = State) ->\n    {reply, ok, State#{ counter => Counter - 1}};\n\nhandle_call(get_counter, _From, #{ counter := Counter } = State) ->\n    {reply, Counter, State};\n\nhandle_call({set_counter, Payload}, _From, State) when is_integer(Payload) ->\n    {reply, ok, State#{ counter => Payload}};\n\nhandle_call({set_counter, Payload}, _From, State) when is_binary(Payload); is_list(Payload) ->\n   case string:to_integer(Payload) of\n      {error, _} ->\n          {reply, not_integer, State};\n      {Integer, _} ->\n          {reply, ok, State#{ counter => Integer}}\n   end;\n\nhandle_call({set_counter, _Payload}, _From, State) ->\n    {reply, not_supported, State};\n\nhandle_call(Msg, _From, State) ->\n    io:format(\"UNKNOWN CALL: ~p~n\", [Msg]),\n    {stop, unknown_call, State}.\n\n%%\n%%\nhandle_cast(fail, State) ->\n    {stop, failed, State};\nhandle_cast(stop, State) ->\n    {stop, normal, State};\nhandle_cast(_Msg, State) ->\n    {noreply, State}.\n\n%%\n%%\nhandle_info(_, State) ->\n    {noreply, State}.\n\n","x":840,"y":148.5,"wires":[]},{"id":"17809b62fe4c8a51","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":1116,"y":351,"wires":[["a8bfffa7442a720d","c224f206be12b604"]]},{"id":"05db1c8b86106e07","type":"inject","z":"38f712d367cecffa","name":"get_counter","props":[{"p":"module","v":"sample_counter_test01","vt":"str"},{"p":"call","v":"get_counter","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":743,"y":351,"wires":[["ce54888e05af5fc3"]]},{"id":"a8bfffa7442a720d","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"1","tot":"num"}],"x":1390,"y":266.5,"wires":[[]]},{"id":"c224f206be12b604","type":"change","z":"38f712d367cecffa","name":"increment","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"increment","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1459,"y":351,"wires":[["298a9c2fe4de2a56","8bd5a693f43505bf","844259c61795f83b"]]},{"id":"298a9c2fe4de2a56","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":1794,"y":291.5,"wires":[["af4fbb70a27c5d31","4e1035568c8b68f8"]]},{"id":"4e1035568c8b68f8","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":2113,"y":212.5,"wires":[[]]},{"id":"af4fbb70a27c5d31","type":"change","z":"38f712d367cecffa","name":"increment","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"increment","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2083,"y":291.5,"wires":[["6acef004c92340fe","30eeab7bc6b0ed79","1a789022d5aa8b23"]]},{"id":"6acef004c92340fe","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":2569,"y":291.5,"wires":[["95fe699811b62d34","5696ca1b2b7f9d22"]]},{"id":"5696ca1b2b7f9d22","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":2874,"y":354.5,"wires":[[]]},{"id":"95fe699811b62d34","type":"change","z":"38f712d367cecffa","name":"increment","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"increment","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2874,"y":291.5,"wires":[["e09eca284daec5b5"]]},{"id":"8bd5a693f43505bf","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":1794,"y":457.75,"wires":[["5a964d16867d34b9","3bebe55e7991ba40"]]},{"id":"3bebe55e7991ba40","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":2113,"y":380.5,"wires":[[]]},{"id":"5a964d16867d34b9","type":"change","z":"38f712d367cecffa","name":"increment","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"increment","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2083,"y":457.75,"wires":[["6acef004c92340fe","30eeab7bc6b0ed79","1a789022d5aa8b23"]]},{"id":"844259c61795f83b","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":1794,"y":623.5,"wires":[["e8632523573662f2","479a4eab41af42ab"]]},{"id":"479a4eab41af42ab","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":2113,"y":541.5,"wires":[[]]},{"id":"e8632523573662f2","type":"change","z":"38f712d367cecffa","name":"increment","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"increment","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2083,"y":623.5,"wires":[["6acef004c92340fe","30eeab7bc6b0ed79","1a789022d5aa8b23"]]},{"id":"30eeab7bc6b0ed79","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":2569,"y":623.5,"wires":[["117c80f9abaf0f42","3d5c69f7942cf55b"]]},{"id":"3d5c69f7942cf55b","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":2874,"y":703.5,"wires":[[]]},{"id":"117c80f9abaf0f42","type":"change","z":"38f712d367cecffa","name":"increment","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"increment","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2874,"y":623.5,"wires":[["e09eca284daec5b5"]]},{"id":"1a789022d5aa8b23","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":2569,"y":457.75,"wires":[["4bfce3d5d160003b","f0a22569491fb06c"]]},{"id":"f0a22569491fb06c","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":2874,"y":528.5,"wires":[[]]},{"id":"4bfce3d5d160003b","type":"change","z":"38f712d367cecffa","name":"increment","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"increment","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2874,"y":457.75,"wires":[["e09eca284daec5b5"]]},{"id":"f8d81fa3377c22b9","type":"inject","z":"38f712d367cecffa","name":"reset","props":[{"p":"module","v":"sample_counter_test01","vt":"str"},{"p":"call","v":"reset","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":617,"y":266.5,"wires":[["87ac5f6da94acad4"]]},{"id":"ce54888e05af5fc3","type":"delay","z":"38f712d367cecffa","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":909,"y":351,"wires":[["17809b62fe4c8a51"]]},{"id":"87ac5f6da94acad4","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":1121,"y":266.5,"wires":[["0486569d515cbdea"]]},{"id":"0486569d515cbdea","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":1390,"y":148.5,"wires":[[]]},{"id":"59481bbe768093b7","type":"debug","z":"38f712d367cecffa","name":"debug 11","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":3278,"y":521,"wires":[]},{"id":"393212952d795da0","type":"join","z":"38f712d367cecffa","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"9","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":3267,"y":404,"wires":[["ff66f7f6f04decf8","329746c2b8858a0c"]]},{"id":"ff66f7f6f04decf8","type":"ut-assert-success","z":"38f712d367cecffa","name":"","x":3502,"y":324.5,"wires":[]},{"id":"b2d4f0e84047b1c0","type":"erlgenserver","z":"38f712d367cecffa","name":"","use_module_name_addressing":true,"scope":["4a8b029644bfca0f"],"x":3812,"y":457.75,"wires":[["f01c7322153f86c3"]]},{"id":"329746c2b8858a0c","type":"change","z":"38f712d367cecffa","name":"get_counter","rules":[{"t":"set","p":"module","pt":"msg","to":"sample_counter_test01","tot":"str"},{"t":"set","p":"call","pt":"msg","to":"get_counter","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3558,"y":404,"wires":[["b2d4f0e84047b1c0"]]},{"id":"f01c7322153f86c3","type":"ut-assert-values","z":"38f712d367cecffa","name":"","ignore_failure_if_succeed":false,"rules":[{"t":"eql","p":"payload","pt":"msg","to":"13","tot":"num"}],"x":4072,"y":324.5,"wires":[[]]}]