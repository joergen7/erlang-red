[{"id":"368c348d25dfc2fe","type":"tab","label":"[genserver] addressing modules","disabled":false,"info":"## Generic Server Node - Addressing\n\nModules can be addressed using either process ids or module names.\n\nThe difference is that modules can only be started once, they become singletons. Which means that if a module dies, all gen server nodes that are using that module also die.\n\nOn the other hand, process-based addressing creates separate instance (i.e. processes) for each instane of the gen server node.\n\n## Technical details \n\nWhat the gen server node is doing at initialisation time is to unregister the module name atom and only use the `gen_server:call(Pid, ...)` method for addressing the module process.\n\nIn the case of the mdoule name addressing, `gen_server:call(?MODULE, ...)` is used via the exported functionality of the <a class=\"ahl-node-only\" data-ids=\"319a0c0cef7adff0\">sample_counter</a> module.\n\n## Test\n\nThe test contains two different configurations of the gen server node: <a class=\"ahl-group-only\" data-ids=\"16bc664dae3f609c\">process addressed modules</a> and <a class=\"ahl-group-only\" data-ids=\"6a046d4947c5b945\">module name addressing</a>. The assert nodes check for the status values of the various gen server nodes.\n\nThose gen server nodes that use module name addressing all crash when the <a class=\"ahl-node-only\" data-ids=\"e38405d7afb19f6b\">stop</a> inject node is triggered by the test. These nodes then generate two status messages, one for being started and the other for being stopped.\n\nThe <a class=\"ahl-group-only\" data-ids=\"16bc664dae3f609c\">process addressed</a> gen server nodes don't crash and hence have only one status message: started.\n\n","env":[{"name":"ERED_TIMEOUT","value":"6","type":"num"}]},{"id":"6a046d4947c5b945","type":"group","z":"368c348d25dfc2fe","name":"module name addressing","style":{"label":true},"nodes":["4a6bf5aa09990e85","7d9bb387cfc8a03d","ca5b1a0d83b1f860","15d052c1ea6f98cf","c95cbfbc0fba80cc","4881cc459271f61e","70817c9a8ca324cc","efe0bf43f94b65f2","9b68310750fc9309","4ae71fbc6020a7b1","734b02ab7078d2f0","3f34b1e5beacc35e","2ef18260a66f756d","cefeeeacb90abcd6","be8435b811c8b753","3e96b7f2ae1d426f","aaa208c5e450dd49","0cd9c37e8ee2b501"],"x":741,"y":304,"w":806.0000457763672,"h":814.5},{"id":"16bc664dae3f609c","type":"group","z":"368c348d25dfc2fe","name":"process addressed modules","style":{"label":true},"nodes":["e12eb464a0b54796","09a95610fc12d76a","0437927a34270706","9359c88c9def11ce","d690b97d147e2bc3","4d5b4f0e2302671f","90cb4957e41fa49a","ad9c15d4e98a5ca9","0f6c4b70f1c2b931","ae485c01a91bbe8c"],"x":1597.3332901000977,"y":205.66665649414062,"w":718.6667175292969,"h":389.49998346964514},{"id":"4a6bf5aa09990e85","type":"erlgenserver","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","use_module_name_addressing":true,"scope":["319a0c0cef7adff0"],"x":857,"y":362,"wires":[[]]},{"id":"319a0c0cef7adff0","type":"erlmodule","z":"368c348d25dfc2fe","name":"","module_name":"sample_counter","code":"-module(sample_counter).\n\n%%\n%% APIs: https://www.erlang.org/doc/apps/stdlib/gen_server.html\n%%\n\n-behaviour(gen_server).\n\n-export([\n    start_link/0,\n    init/1,\n    handle_call/3,\n    handle_cast/2,\n    handle_info/2,\n    code_change/3,\n    terminate/2,\n    stop/0,\n    fail/0\n]).\n\n%%\n%% Externer exports\n-export([\n   increment/0,\n   decrement/0,\n   get_counter/0,\n   set_counter/1\n]).\n\n%%\n%% External APIs\nincrement() ->\n   gen_server:call(?MODULE, increment).\n\ndecrement() ->\n   gen_server:call(?MODULE, decrement).\n\nget_counter() ->\n   gen_server:call(?MODULE, get_counter).\n\nset_counter(Value) ->\n   gen_server:call(?MODULE, {set_counter, Value}).\n\n%%\n%%\nstart_link() ->\n    gen_server:start_link({local, ?MODULE}, ?MODULE, #{counter => 0}, []).\n\ninit(Args) ->\n    {ok, Args#{ counter => 1 }}.\n\nstop() ->\n    io:format(\"Terminging ~n\",[]),\n    gen_server:cast(?MODULE, stop).\n\nfail() ->\n    io:format(\"Failing ~n\",[]),\n    gen_server:cast(?MODULE, fail).\n\n\nterminate(_Event, _State) ->\n    ok.\n\ncode_change(_OldVersion, State, _Extra) ->\n    {ok, State}.\n\n%%\n%%\nhandle_call(increment, _From, #{ counter := Counter } = State) ->\n    {reply, ok, State#{ counter => Counter + 1}};\n\nhandle_call(decrement, _From, #{ counter := Counter } = State) ->\n    {reply, ok, State#{ counter => Counter - 1}};\n\nhandle_call(get_counter, _From, #{ counter := Counter } = State) ->\n    {reply, Counter, State};\n\nhandle_call({set_counter, Payload}, _From, State) when is_integer(Payload) ->\n    {reply, ok, State#{ counter => Payload}};\n\nhandle_call({set_counter, Payload}, _From, State) when is_binary(Payload); is_list(Payload) ->\n   case string:to_integer(Payload) of\n      {error, _} ->\n          {reply, not_integer, State};\n      {Integer, _} ->\n          {reply, ok, State#{ counter => Integer}}\n   end;\n\nhandle_call({set_counter, _Payload}, _From, State) ->\n    {reply, not_supported, State};\n\nhandle_call(Msg, _From, State) ->\n    io:format(\"UNKNOWN CALL: ~p~n\", [Msg]),\n    {stop, unknown_call, State}.\n\n%%\n%%\nhandle_cast(fail, State) ->\n    {stop, failed, State};\nhandle_cast(stop, State) ->\n    {stop, normal, State};\nhandle_cast(_Msg, State) ->\n    {noreply, State}.\n\n%%\n%%\nhandle_info(_, State) ->\n    {noreply, State}.\n\n","x":1560.666748046875,"y":98.99996948242188,"wires":[]},{"id":"7d9bb387cfc8a03d","type":"erlgenserver","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","use_module_name_addressing":true,"scope":["319a0c0cef7adff0"],"x":857,"y":521,"wires":[[]]},{"id":"e38405d7afb19f6b","type":"inject","z":"368c348d25dfc2fe","name":"stop","props":[{"p":"module","v":"sample_counter","vt":"str"},{"p":"call","v":"stop","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":430,"y":836.6666870117188,"wires":[["7d9bb387cfc8a03d"]]},{"id":"ca5b1a0d83b1f860","type":"erlgenserver","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","use_module_name_addressing":true,"scope":["319a0c0cef7adff0"],"x":857,"y":680,"wires":[[]]},{"id":"15d052c1ea6f98cf","type":"status","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","scope":["4a6bf5aa09990e85"],"x":827,"y":441.5,"wires":[["c95cbfbc0fba80cc","cefeeeacb90abcd6"]]},{"id":"c95cbfbc0fba80cc","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for started status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"green","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"started","tot":"str"}],"x":1411.0000457763672,"y":448.5238023485456,"wires":[[]]},{"id":"4881cc459271f61e","type":"status","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","scope":["7d9bb387cfc8a03d"],"x":827,"y":600.5,"wires":[["70817c9a8ca324cc","be8435b811c8b753"]]},{"id":"70817c9a8ca324cc","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for started status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"green","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"started","tot":"str"}],"x":1411.0000457763672,"y":655.5714070456368,"wires":[[]]},{"id":"efe0bf43f94b65f2","type":"status","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","scope":["ca5b1a0d83b1f860"],"x":827,"y":759.5,"wires":[["9b68310750fc9309","3e96b7f2ae1d426f"]]},{"id":"9b68310750fc9309","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for stopped status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"green","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"started","tot":"str"}],"x":1411.0000457763672,"y":759.0952093941823,"wires":[[]]},{"id":"4ae71fbc6020a7b1","type":"erlgenserver","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","use_module_name_addressing":true,"scope":["319a0c0cef7adff0"],"x":857,"y":918.5,"wires":[[]]},{"id":"734b02ab7078d2f0","type":"erlgenserver","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","use_module_name_addressing":true,"scope":["319a0c0cef7adff0"],"x":857,"y":1077.5,"wires":[[]]},{"id":"e12eb464a0b54796","type":"erlgenserver","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","use_module_name_addressing":false,"scope":["319a0c0cef7adff0"],"x":1713.3332901000977,"y":246.66665649414062,"wires":[[]]},{"id":"09a95610fc12d76a","type":"erlgenserver","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","use_module_name_addressing":false,"scope":["319a0c0cef7adff0"],"x":1723.9999542236328,"y":478.6666564941406,"wires":[[]]},{"id":"0437927a34270706","type":"status","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","scope":["e12eb464a0b54796"],"x":1774.6666259765625,"y":321.25001668930054,"wires":[["9359c88c9def11ce","ad9c15d4e98a5ca9"]]},{"id":"9359c88c9def11ce","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"green","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"started","tot":"str"}],"x":2005.6666259765625,"y":246.66665649414062,"wires":[[]]},{"id":"d690b97d147e2bc3","type":"status","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","scope":["09a95610fc12d76a"],"x":1780.6666259765625,"y":554.1666399637858,"wires":[["4d5b4f0e2302671f","90cb4957e41fa49a"]]},{"id":"4d5b4f0e2302671f","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"green","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"started","tot":"str"}],"x":2011.6666259765625,"y":478.6666564941406,"wires":[[]]},{"id":"3f34b1e5beacc35e","type":"status","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","scope":["ca5b1a0d83b1f860"],"x":827,"y":839,"wires":[["aaa208c5e450dd49"]]},{"id":"2ef18260a66f756d","type":"status","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"","scope":["ca5b1a0d83b1f860"],"x":827,"y":998,"wires":[["0cd9c37e8ee2b501"]]},{"id":"cefeeeacb90abcd6","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for stopped status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"red","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"stopped","tot":"str"}],"x":1411.0000457763672,"y":345,"wires":[[]]},{"id":"be8435b811c8b753","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for stopped status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"red","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"stopped","tot":"str"}],"x":1411.0000457763672,"y":552.0476046970912,"wires":[[]]},{"id":"3e96b7f2ae1d426f","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for started status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"red","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"stopped","tot":"str"}],"x":1411.0000457763672,"y":862.6190117427279,"wires":[[]]},{"id":"aaa208c5e450dd49","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for stopped status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"red","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"stopped","tot":"str"}],"x":1411.0000457763672,"y":966.1428140912735,"wires":[[]]},{"id":"0cd9c37e8ee2b501","type":"ut-assert-values","z":"368c348d25dfc2fe","g":"6a046d4947c5b945","name":"check for stopped status","ignore_failure_if_succeed":true,"rules":[{"p":"status.fill","pt":"msg","t":"eql","to":"red","tot":"str"},{"p":"status.shape","pt":"msg","t":"eql","to":"dot","tot":"str"},{"p":"status.text","pt":"msg","t":"eql","to":"stopped","tot":"str"}],"x":1411.0000457763672,"y":1069.6666164398193,"wires":[[]]},{"id":"90cb4957e41fa49a","type":"join","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":2013.333374023437,"y":554.1666399637858,"wires":[["ae485c01a91bbe8c"]]},{"id":"ad9c15d4e98a5ca9","type":"join","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":2006.6666259765625,"y":321.25001668930054,"wires":[["0f6c4b70f1c2b931"]]},{"id":"0f6c4b70f1c2b931","type":"ut-assert-failure","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","x":2203.3333435058594,"y":321.25001668930054,"wires":[]},{"id":"ae485c01a91bbe8c","type":"ut-assert-failure","z":"368c348d25dfc2fe","g":"16bc664dae3f609c","name":"","x":2220.0000076293945,"y":554.1666399637858,"wires":[]}]