[{"id":"264a27b9ee0e4245","type":"tab","label":"[eventhandler] handle kill exits","disabled":false,"info":"## Kill exits\n\nAn extension of the [exit with normal exit](https://flows.red-erik.org/f/1ac53952c6ec6ef6) test.\n\nThe difference between an `exit(self(), kill)` and `exit(self(), normal)` is that the kill exit will also kill the parent process of the event handler.\n\nThe handler is being killed not the parent process.\n\n","env":[{"name":"ERED_NOT_EUNIT","value":"true","type":"bool"}]},{"id":"7be8581484383c94","type":"group","z":"264a27b9ee0e4245","name":"generate a_single_event events","style":{"label":true},"nodes":["1fdb9d0a69779dbf","a387ac671e32d393","04fc7818352a02a3"],"x":5,"y":439.95233154296875,"w":630.3334045410156,"h":160.70833110809326},{"id":"0a5cbbcddee8ec0b","type":"group","z":"264a27b9ee0e4245","name":"supervisor does restart","style":{"label":true},"nodes":["87ee77bf0dd47ae7","7e43d2b9f8642c5e"],"x":689,"y":684.5,"w":372,"h":136.5},{"id":"1165a6cfb76dbb49","type":"group","z":"264a27b9ee0e4245","name":"supervisor does not do restart","style":{"label":true},"nodes":["2198b6bff086aa3e","e9f400645d1e6024"],"x":720,"y":506.5,"w":272,"h":136.5},{"id":"ece2c33f8f59ab11","type":"erlmodule","z":"264a27b9ee0e4245","name":"","module_name":"exit_with_kill_event_handler_process","code":"-module(exit_with_kill_event_handler_process).\n\n-behaviour(gen_event).\n\n-export([\n    init/1,\n    handle_event/2,\n    handle_call/2,\n    handle_info/2,\n    terminate/2,\n    code_change/3\n]).\n\n-import(ered_nodes, [\n    send_msg_to_connected_nodes/2\n]).\n\ninit(Args) ->\n    {ok, #{count => 1}}.\n\nhandle_event({<<\"a_single_event\">>, Msg, EventHandlerNodeDef}, #{ count := Count } = State) when Count > 5 ->\n    exit(self(), kill),\n    {ok, State#{ count => Count + 1 }};\n\nhandle_event({<<\"a_single_event\">>, Msg, EventHandlerNodeDef}, #{ count := Count } = State) ->\n    Msg2 = Msg#{ \n        <<\"handled\">> => <<\"a_single_event\">>, \n        <<\"count\">> => Count,\n        <<\"handler\">> => ?MODULE\n    },    \n    send_msg_to_connected_nodes(EventHandlerNodeDef, Msg2),\n    {ok, State#{ count => Count + 1 }};\n\nhandle_event(_Event, State) ->\n    {ok, State}.\n\nhandle_call(_Request, State) ->\n    {ok, ok, State}.\n\nhandle_info(_Info, State) ->\n    {ok, State}.\n\nterminate(Args, _State) ->\n    Args.\n\ncode_change(_OldVsn, State, _Extra) ->\n    {ok, State}.\n","x":885.666748046875,"y":260,"wires":[]},{"id":"d70bff40f4f53bbf","type":"inject","z":"264a27b9ee0e4245","name":"","props":[{"p":"msgcnt","v":"0","vt":"num"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":186.00000286102295,"y":296.3333978652954,"wires":[["1fdb9d0a69779dbf"]]},{"id":"ab1aa4f48932986b","type":"join","z":"264a27b9ee0e4245","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"200","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":765.3333740234375,"y":938.2023315429688,"wires":[["605e25477b5eec2d"]]},{"id":"605e25477b5eec2d","type":"ut-assert-success","z":"264a27b9ee0e4245","name":"","x":944.3333740234375,"y":938.2023315429688,"wires":[]},{"id":"f956b1fa88bf3752","type":"join","z":"264a27b9ee0e4245","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1191.8333740234375,"y":485.95233154296875,"wires":[["659fb9ee4a159f6f"]]},{"id":"659fb9ee4a159f6f","type":"ut-assert-success","z":"264a27b9ee0e4245","name":"","x":1377.3333740234375,"y":485.95233154296875,"wires":[]},{"id":"8b0b8a9dc74b82b0","type":"join","z":"264a27b9ee0e4245","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"6","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1190.8333740234375,"y":416.20233154296875,"wires":[["a58a3508c36cb171"]]},{"id":"a58a3508c36cb171","type":"ut-assert-failure","z":"264a27b9ee0e4245","name":"","x":1377.3333740234375,"y":416.20233154296875,"wires":[]},{"id":"64133eaec0bf4365","type":"erleventhandler","z":"264a27b9ee0e4245","name":"handler with exit(kill)","handlers":[{"nodeid":"ece2c33f8f59ab11"}],"x":854.761962890625,"y":448.6666259765625,"wires":[["f956b1fa88bf3752","8b0b8a9dc74b82b0"]]},{"id":"1fdb9d0a69779dbf","type":"change","z":"264a27b9ee0e4245","g":"7be8581484383c94","name":"","rules":[{"p":"event","pt":"msg","t":"set","to":"a_single_event","tot":"str"},{"p":"msgcnt","pt":"msg","t":"set","to":"$$.msgcnt + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":367.3333740234375,"y":480.95233154296875,"wires":[["a387ac671e32d393"]]},{"id":"a387ac671e32d393","type":"delay","z":"264a27b9ee0e4245","g":"7be8581484383c94","name":"","pauseType":"random","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"milliseconds","drop":false,"allowrate":false,"outputs":1,"x":549.3334045410156,"y":556.660662651062,"wires":[["04fc7818352a02a3","64133eaec0bf4365","ab1aa4f48932986b","e9f400645d1e6024","87ee77bf0dd47ae7"]]},{"id":"04fc7818352a02a3","type":"switch","z":"264a27b9ee0e4245","g":"7be8581484383c94","name":"stop after 200 messages","property":"msgcnt","propertyType":"msg","rules":[{"t":"lt","v":"200","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":141,"y":559.660662651062,"wires":[["1fdb9d0a69779dbf"]]},{"id":"5ffdff969fa32d98","type":"erlmodule","z":"264a27b9ee0e4245","name":"","module_name":"exit_with_normal_event_handler_process","code":"-module(exit_with_normal_event_handler_process).\n\n-behaviour(gen_event).\n\n-export([\n    init/1,\n    handle_event/2,\n    handle_call/2,\n    handle_info/2,\n    terminate/2,\n    code_change/3\n]).\n\n-import(ered_nodes, [\n    send_msg_to_connected_nodes/2\n]).\n\ninit(Args) ->\n    {ok, #{count => 1}}.\n\nhandle_event({<<\"a_single_event\">>, Msg, #{ '_eventh_pid' := HndlrParentPid} =EventHandlerNodeDef}, #{ count := Count } = State) when Count > 5 ->\n    exit(self(), normal),\n    {ok, State#{ count => Count + 1 }};\n\nhandle_event({<<\"a_single_event\">>, Msg, EventHandlerNodeDef}, #{ count := Count } = State) ->\n    Msg2 = Msg#{ \n        <<\"handled\">> => <<\"a_single_event\">>, \n        <<\"count\">> => Count,\n        <<\"handler\">> => ?MODULE\n    },    \n    send_msg_to_connected_nodes(EventHandlerNodeDef, Msg2),\n    {ok, State#{ count => Count + 1 }};\n\nhandle_event(_Event, State) ->\n    {ok, State}.\n\nhandle_call(_Request, State) ->\n    {ok, ok, State}.\n\nhandle_info(_Info, State) ->\n    {ok, State}.\n\nterminate(Args, _State) ->\n    Args.\n\ncode_change(_OldVsn, State, _Extra) ->\n    {ok, State}.\n","x":898,"y":312,"wires":[]},{"id":"e9f400645d1e6024","type":"erleventhandler","z":"264a27b9ee0e4245","g":"1165a6cfb76dbb49","name":"handler with exit(normal)","handlers":[{"nodeid":"5ffdff969fa32d98"}],"x":856,"y":602,"wires":[["72be955e23f636fc","42c43bcaffcac340"]]},{"id":"87ee77bf0dd47ae7","type":"erleventhandler","z":"264a27b9ee0e4245","g":"0a5cbbcddee8ec0b","name":"event handler with exit normal and exit kill","handlers":[{"nodeid":"ece2c33f8f59ab11"},{"nodeid":"5ffdff969fa32d98"}],"x":875,"y":780,"wires":[["6081e9b3be592125","d0a3fa3d3dd0021f"]]},{"id":"d0a3fa3d3dd0021f","type":"join","z":"264a27b9ee0e4245","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"40","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1227.5,"y":804,"wires":[["cd8a6863f108e052"]]},{"id":"cd8a6863f108e052","type":"ut-assert-success","z":"264a27b9ee0e4245","name":"","x":1413,"y":804,"wires":[]},{"id":"6081e9b3be592125","type":"join","z":"264a27b9ee0e4245","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"41","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1226.5,"y":734.25,"wires":[["5cc795d1c92e72f0"]]},{"id":"5cc795d1c92e72f0","type":"ut-assert-failure","z":"264a27b9ee0e4245","name":"","x":1413,"y":734.25,"wires":[]},{"id":"42c43bcaffcac340","type":"join","z":"264a27b9ee0e4245","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1201.5,"y":635,"wires":[["6ebb1113eadf93f7"]]},{"id":"6ebb1113eadf93f7","type":"ut-assert-success","z":"264a27b9ee0e4245","name":"","x":1387,"y":635,"wires":[]},{"id":"72be955e23f636fc","type":"join","z":"264a27b9ee0e4245","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"6","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1200.5,"y":565.25,"wires":[["4bf844722d01e106"]]},{"id":"4bf844722d01e106","type":"ut-assert-failure","z":"264a27b9ee0e4245","name":"","x":1387,"y":565.25,"wires":[]},{"id":"7e43d2b9f8642c5e","type":"erlsupervisor","z":"264a27b9ee0e4245","g":"0a5cbbcddee8ec0b","name":"","scope":["87ee77bf0dd47ae7"],"supervisor_type":"static","strategy":"one_for_one","auto_shutdown":"never","intensity":"3","period":"5","child_type":"worker","child_restart":"permanent","child_shutdown":"infinite","child_shutdown_timeout":"0","x":787,"y":725.5,"wires":[[]]},{"id":"2198b6bff086aa3e","type":"erlsupervisor","z":"264a27b9ee0e4245","g":"1165a6cfb76dbb49","name":"","scope":["e9f400645d1e6024"],"supervisor_type":"static","strategy":"one_for_one","auto_shutdown":"never","intensity":"3","period":"5","child_type":"worker","child_restart":"permanent","child_shutdown":"infinite","child_shutdown_timeout":"0","x":842,"y":547.5,"wires":[[]]}]