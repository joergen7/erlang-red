[{"id":"cfa8595b2e2b8269","type":"tab","label":"[tcp] tcp-out node in reply mode","disabled":false,"info":"## Multiple tcp in nodes\n\nTest checks for handling of `_session` value on the message.\n\n## Setup\n\nNode <a class=\"ahl-node-only\" data-ids=\"cdf9310b209c1838\">tcp:1234</a> is a tcp listener, listening on port 1234 for incoming connections.\n\nNode <a class=\"ahl-node-only\" data-ids=\"dd0e889f20803d72\">tcp:localhost:1234</a> is a tcp-in node that *connects* to a server on *localhost* on port 1234, that is, it connects to <a class=\"ahl-node-only\" data-ids=\"cdf9310b209c1838\">tcp:1234</a>.\n\nSince both nodes are tcp-in nodes, they *produce* messages but do not receive messages.\n\nA tcp-out node <a class=\"ahl-node-only\" data-ids=\"efcdb65d343c28d5\">tcp:</a> is used to create a message. This is tcp-out node set to **reply** mode meaning it needs a `_session` attribute on the message to know where to send messages it receives to.\n\n## Test\n\nThe <a class=\"ahl-node-only\" data-ids=\"b19e4f202ce8e9f9\">inject node</a> sends a \"hello world\" message to the <a class=\"ahl-node-only\" data-ids=\"efcdb65d343c28d5\">tcp out</a> node without a `_session` attribute on the message.\n\n\n## Discussion\n\nIf the <a class=\"ahl-node-only\" data-ids=\"dd0e889f20803d72\">tcp:localhost:1234</a> node is set to \"single string\" instead if \"stream of strings\", then it receives nothing.\n\nSo it receives a message from the tcp-out node, sends it to the listener and the response with a \"ok\" and that is sent back to it.\n\n**NOTE**: the difference between single string and stream of strings is that the string is only sent once the [connection is dropped](https://github.com/node-red/node-red/blob/01815b995e1bf2c87a82afe1a51d563a2d83fe31/packages/node_modules/%40node-red/nodes/core/network/31-tcpin.js#L158-L168).\n\n","env":[{"name":"ERED_PENDING","type":"bool","value":"false"},{"name":"ERED_NOT_EUNIT","type":"bool","value":"true"},{"name":"ERED_TIMEOUT","type":"num","value":"11"}]},{"id":"cdf9310b209c1838","type":"tcp in","z":"cfa8595b2e2b8269","name":"","server":"server","host":"","port":"1202","datamode":"stream","datatype":"utf8","newline":"","topic":"","trim":false,"base64":false,"tls":"","x":609,"y":444,"wires":[["922894e195cfced3","05791bcf224aaa46"]]},{"id":"1a2c994da573bbdf","type":"ut-assert-values","z":"cfa8595b2e2b8269","name":"","ignore_failure_if_succeed":false,"rules":[{"p":"payload","pt":"msg","t":"eql","to":"hello world","tot":"str"}],"x":1200,"y":444,"wires":[[]]},{"id":"efcdb65d343c28d5","type":"tcp out","z":"cfa8595b2e2b8269","name":"","host":"","port":"","beserver":"reply","base64":false,"end":false,"tls":"","x":1000,"y":318.5,"wires":[]},{"id":"b19e4f202ce8e9f9","type":"inject","z":"cfa8595b2e2b8269","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"hello world","payloadType":"str","x":611,"y":311.5,"wires":[["7d6bf09f58c27260"]]},{"id":"922894e195cfced3","type":"change","z":"cfa8595b2e2b8269","name":"set payload to 'ok'","rules":[{"p":"payload","pt":"msg","t":"set","to":"ok","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":809,"y":379.5,"wires":[["efcdb65d343c28d5"]]},{"id":"dd0e889f20803d72","type":"tcp in","z":"cfa8595b2e2b8269","name":"","server":"client","host":"localhost","port":"1202","datamode":"stream","datatype":"utf8","newline":"","topic":"","trim":true,"base64":false,"tls":"","x":579,"y":558.25,"wires":[["bce5848d37f39724","7f8b02809692770c"]]},{"id":"b39f939d9714e413","type":"ut-assert-values","z":"cfa8595b2e2b8269","name":"","ignore_failure_if_succeed":true,"rules":[{"p":"payload","pt":"msg","t":"eql","to":"hello world","tot":"str"}],"x":1225,"y":539.25,"wires":[[]]},{"id":"e8a72df7e2694bc4","type":"ut-assert-values","z":"cfa8595b2e2b8269","name":"","ignore_failure_if_succeed":true,"rules":[{"p":"payload","pt":"msg","t":"eql","to":"ok","tot":"str"}],"x":1256,"y":636,"wires":[[]]},{"id":"dc0c5ddff9da36b6","type":"tcp out","z":"cfa8595b2e2b8269","name":"","host":"","port":"","beserver":"reply","base64":false,"end":false,"tls":"","x":1004,"y":203,"wires":[]},{"id":"bce5848d37f39724","type":"debug","z":"cfa8595b2e2b8269","name":"debug 1","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"counter","x":830,"y":499,"wires":[]},{"id":"7d6bf09f58c27260","type":"delay","z":"cfa8595b2e2b8269","name":"","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":822,"y":250,"wires":[["dc0c5ddff9da36b6"]]},{"id":"05791bcf224aaa46","type":"switch","z":"cfa8595b2e2b8269","name":"only data packets","property":"_session.status","propertyType":"msg","rules":[{"t":"eq","v":"connected","vt":"str"}],"checkall":"false","repair":false,"outputs":1,"x":860,"y":444,"wires":[["1a2c994da573bbdf"]]},{"id":"7f8b02809692770c","type":"switch","z":"cfa8595b2e2b8269","name":"only data packets","property":"_session.status","propertyType":"msg","rules":[{"t":"eq","v":"connected","vt":"str"}],"checkall":"false","repair":false,"outputs":1,"x":847,"y":595,"wires":[["e8a72df7e2694bc4","b39f939d9714e413"]]}]