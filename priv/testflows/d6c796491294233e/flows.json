[{"id":"d6c796491294233e","type":"tab","label":"[supervisor] supervising two function nodes","disabled":false,"info":"Simple exampe of using the supervisor node to revive a function node that dies because it does a divide by zero.\n\nThe inject node can be pressed five times[1] and after the supervisor dies - check the configuration of the supervisor node for why this happens.\n\nThe <a class=\"ahl-node-only\" data-ids=\"3c8c8d8fa8232bc4\">delay 500ms</a> node is there to ensure that the message goes through to the <a class=\"ahl-node-only\" data-ids=\"96713a5958600f3b\">Assert True</a> node before the <a class=\"ahl-node-only\" data-ids=\"66a17d54fe9f3bdd\">function 1</a> node is restarted because the divide by zero error <a class=\"ahl-node-only\" data-ids=\"373d6e3f9b852130\">node</a> fails.\n\n*NOTE* Not run as eunit test because it produces error messages about supervisors crashing - something that is meant to happen.\n\n[1]: Move a node, deploy the flow and then it's started. Inject button then has an affect.","env":[{"name":"ERED_NOT_EUNIT","type":"bool","value":"true"},{"name":"ERED_TIMEOUT","type":"num","value":"4"}]},{"id":"4c3356e96385c30b","type":"group","z":"d6c796491294233e","style":{"color":"#a4a4a4","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","stroke":"#999999","stroke-opacity":"1"},"nodes":["373d6e3f9b852130","66a17d54fe9f3bdd","7415aceb164005dd"],"x":469,"y":405.16668701171875,"w":232,"h":284.83331298828125},{"id":"373d6e3f9b852130","type":"function","z":"d6c796491294233e","g":"4c3356e96385c30b","name":"divide by zero error","func":"ered_nodered_comm:post_exception_or_debug(NodeDef, Msg, <<\"divide by zero\">>),\n1 / 0","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":585,"y":501.25,"wires":[["3f010ba469a458a6"]]},{"id":"ca0b875d707b9b25","type":"inject","z":"d6c796491294233e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":172,"y":649,"wires":[["66a17d54fe9f3bdd","3c8c8d8fa8232bc4"]]},{"id":"22f4b43bd101fa0c","type":"debug","z":"d6c796491294233e","name":"debug 1","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"","statusType":"counter","x":1079,"y":258.25,"wires":[]},{"id":"66a17d54fe9f3bdd","type":"function","z":"d6c796491294233e","g":"4c3356e96385c30b","name":"function 1","func":"maps:put(<<\"hello\">>,world,Msg)\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":585,"y":649,"wires":[["96713a5958600f3b","2b24ab92a5a25fdf"]]},{"id":"3f010ba469a458a6","type":"ut-assert-failure","z":"d6c796491294233e","name":"","x":898,"y":501.25,"wires":[]},{"id":"96713a5958600f3b","type":"ut-assert-success","z":"d6c796491294233e","name":"","x":898,"y":575.125,"wires":[]},{"id":"2b24ab92a5a25fdf","type":"debug","z":"d6c796491294233e","name":"debug 2","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"","statusType":"counter","x":908,"y":649,"wires":[]},{"id":"33074a4c0243ec99","type":"catch","z":"d6c796491294233e","name":"","scope":["373d6e3f9b852130"],"uncaught":false,"x":298,"y":177,"wires":[["79d730c375733e32","bf4ae0b0a489befb"]]},{"id":"79d730c375733e32","type":"debug","z":"d6c796491294233e","name":"debug 3","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"","statusType":"counter","x":589.8571472167969,"y":80.57143211364746,"wires":[]},{"id":"bf4ae0b0a489befb","type":"ut-assert-success","z":"d6c796491294233e","name":"","x":868,"y":171,"wires":[]},{"id":"079a3c0e58372482","type":"switch","z":"d6c796491294233e","name":"supervisor dead?","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"dead","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":854,"y":353.25,"wires":[["b69e93448c758331"]]},{"id":"b69e93448c758331","type":"delay","z":"d6c796491294233e","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":585,"y":258.25,"wires":[["22f4b43bd101fa0c","f085471e5c4dc05e"]]},{"id":"f085471e5c4dc05e","type":"change","z":"d6c796491294233e","name":"","rules":[{"p":"action","pt":"msg","t":"set","to":"restart","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":323,"y":353.25,"wires":[["7415aceb164005dd"]]},{"id":"7415aceb164005dd","type":"erlsupervisor","z":"d6c796491294233e","g":"4c3356e96385c30b","name":"","scope":["373d6e3f9b852130","66a17d54fe9f3bdd"],"supervisor_type":"static","strategy":"one_for_all","auto_shutdown":"never","intensity":"5","period":"30","child_type":"worker","child_restart":"permanent","child_shutdown":"brutal_kill","child_shutdown_timeout":"0","x":586.6666870117188,"y":446.16668701171875,"wires":[["079a3c0e58372482"]]},{"id":"3c8c8d8fa8232bc4","type":"delay","z":"d6c796491294233e","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":371,"y":562,"wires":[["373d6e3f9b852130"]]}]